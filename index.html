<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lonny Grafman — Portfolio</title>
  <meta name="description" content="Educator, designer, and facilitator building resilient, community-led futures. Projects, teaching, and open work.">
  <meta property="og:title" content="Lonny Grafman — Portfolio">
  <meta property="og:description" content="Educator, designer, and facilitator building resilient, community-led futures.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/og-card.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">

  <!-- Configure the CSV here (or pass ?csv=...) -->
  <script>
    window.PORTFOLIO_CONFIG = {
      CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRwYDBqR1Ig7T0gzs172Esm_cpJ28o8JwClwiiLtXQ65Fjd4_aVY13nKR3p_F6Qtpjq76p9yDYpsmFl/pub?output=csv"
    };
  </script>

  <style>
    :root{
      --bg:#0b0c0c; --text:#e7e7e7; --muted:#a0a0a0;
      --card:#141515; --line:#1f2020;
      --accent:#39ff14; /* neon moss */
      --radius:18px; --pad:18px; --gap:18px; --max:1080px;
      color-scheme: dark light;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#ffffff; --text:#111; --muted:#565656; --card:#f8f8f8; --line:#eaeaea; }
    }

    html,body{margin:0; padding:0; background:var(--bg); color:var(--text);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    h1,h2,h3{font-family:"IBM Plex Mono",ui-monospace,SFMono-Regular,Menlo,monospace; letter-spacing:.2px;}
    h1{font-size:clamp(2rem,3vw,3rem); line-height:1.1;}
    .lede{max-width:60ch; color:var(--muted);}

    .wrap{max-width:var(--max); margin-inline:auto; padding:clamp(16px,3vw,32px);}
    .site-header{position:relative}
    .nav{display:flex; gap:20px; justify-content:flex-end}
    .nav__link{position:relative; text-decoration:none; color:var(--text);}
    .nav__link::after{content:""; position:absolute; left:0; bottom:-3px; width:0; height:2px; background:var(--accent); transition:width .25s ease;}
    .nav__link:hover::after{width:100%;}

    .hero{padding-top:28px;}
    .hero__ctas{display:flex; gap:12px; margin-top:16px}
    .btn{border-radius:999px; padding:.7rem 1rem; border:1px solid var(--line); background:transparent; color:var(--text); cursor:pointer; text-decoration:none; display:inline-block}
    .btn--primary{background:var(--accent); color:#000; border:0; box-shadow:0 0 0 2px #000 inset;}
    .btn--ghost:hover{border-color:var(--accent);}

    .hero__intro{
  display:grid;
  grid-template-columns: 1fr auto;
  gap:16px;
  align-items:center;
  margin-top:10px;
}
  .hero__portrait{
    width:96px; height:96px; border-radius:16px; object-fit:cover; object-position:top;
    border:1px solid var(--line);
    cursor:pointer;
    transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
  }
.hero__portrait:hover{
  transform:translateY(-2px);
  border-color: color-mix(in oklab, var(--accent) 50%, var(--line));
  box-shadow:0 8px 22px rgba(0,0,0,.25);
 
  html.punk .hero__portrait{
  box-shadow:0 0 12px var(--accent), 0 0 24px var(--accent);
  border-color: var(--accent);
}
}
@media (max-width:640px){
  .hero__intro{
    grid-template-columns: 1fr auto;
    gap:12px;
  }
  .hero__portrait{ width:80px; height:80px; }
}

    
    .grid{display:grid; gap:var(--gap); grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); margin-top:1rem;}
    .card{position:relative; background:var(--card); border:1px solid var(--line); border-radius:var(--radius); overflow:hidden; transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;}
    .card:hover{transform:translateY(-4px); border-color:color-mix(in oklab,var(--accent) 50%,var(--line)); box-shadow:0 10px 30px rgba(0,0,0,.2);}
    .card img{display:block; width:100%; height:220px; object-fit:cover; filter:saturate(1.02);}
    .card__overlay{
      position:absolute; left:0; right:0; bottom:0;
      padding:12px 14px; color:#fff;
      font-family:"IBM Plex Mono",ui-monospace,monospace; font-weight:600; letter-spacing:.2px;
      text-shadow:0 1px 2px rgba(0,0,0,.6);
      background:linear-gradient(to top, rgba(0,0,0,.6), rgba(0,0,0,0) 70%);
      border-top:1px solid rgba(255,255,255,.08);
    }
    .card:hover .card__overlay{background:linear-gradient(to top,rgba(0,0,0,.72),rgba(0,0,0,0) 70%);}

    .scroll-progress{
      position:sticky; bottom:12px; height:3px; margin-top:40px;
      background:linear-gradient(90deg,var(--accent) var(--_pct,0%),transparent 0);
      border-radius:999px; opacity:.7;
    }

    .about{
      position:fixed; inset:clamp(20px,3vw,40px);
      background:var(--card); border:1px solid var(--line); border-radius:24px;
      display:grid; grid-template-columns:260px 1fr; gap:24px; padding:24px;
      box-shadow:0 20px 60px rgba(0,0,0,.4);
    }
    .about[hidden]{display:none;}
      .about__img{width:100%; height:100%; object-fit:cover; object-position:top; border-radius:16px;}
      .about__close{
        position:absolute; top:12px; right:12px;
        width:32px; height:32px;
        display:flex; align-items:center; justify-content:center;
        font-size:24px;
        background:rgba(0,0,0,.75);
        color:#fff; border:0; border-radius:8px;
        cursor:pointer;
      }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); padding:24px;}
    .modal[open]{display:flex}
    .modal__dialog{
      max-width:880px; width:min(95vw,880px); background:var(--card); border:1px solid var(--line); border-radius:24px;
      overflow:hidden; display:grid; grid-template-columns:1fr 1fr;
    }
    .modal__img{width:100%; height:100%; object-fit:cover; background:#000; min-height:260px}
    .modal__body{padding:24px;}
    .modal__title{margin:0 0 .25rem}
    .meta{color:var(--muted); font-size:.95rem;}
    .btnrow{display:flex; flex-wrap:wrap; gap:10px; margin-top:16px}
    .chip{font:12px/1.2 ui-monospace,SFMono-Regular,Menlo,monospace; padding:.35rem .5rem; border:1px dashed var(--line); border-radius:999px;}

    .site-footer{display:flex; justify-content:space-between; align-items:center; gap:16px; font-size:.95rem; border-top:1px solid var(--line); margin-top:32px; padding-top:16px}
    .social a{margin-right:10px; text-decoration:none; color:var(--muted);}
    .social a:hover{color:var(--accent)}

    /* Subtle SVG noise overlay */
    body::after{
      content:""; pointer-events:none; position:fixed; inset:0;
      background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.025"/></svg>');
      mix-blend-mode:overlay; opacity:.6;
    }

    @media (prefers-reduced-motion: reduce){ *{animation:none!important; transition:none!important} }

    /* Punk mode (Konami) */
    html.punk{ --accent:#ff2dfb; filter:contrast(1.03) saturate(1.08);}
    html.punk body{ animation:crt 0.12s steps(2,end) infinite;}
    @keyframes crt { 50% { transform: translateY(.3px) } }

    @media (max-width:860px){ .modal__dialog{grid-template-columns:1fr;} }

  @media (max-width: 600px) {
    .about {
    inset: 0 !important;
    border-radius: 0 !important;
    padding: 14px !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    box-shadow: none !important;
    overflow-y: auto !important;
    }
    .about__img {
      max-height: 180px;
      height: auto;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .about__text {
      font-size: 1rem;
    }
  }

  </style>
</head>
<body>
  <header class="site-header wrap">
    <nav class="nav" aria-label="Primary">
      <a href="#projects" class="nav__link">Projects</a>
      <a href="#about" class="nav__link" data-open-about>About</a>
      <a href="#contact" class="nav__link">Contact</a>
    </nav>

<section class="hero" aria-labelledby="intro">
  <h1 id="intro">Lonny Grafman</h1>

  <div class="hero__intro">
    <p class="lede">
      Author, Designer, Educator, Facilitator, Public Speaker, and most importantly teammate with people making epic stuff happen.
    </p>

    <!-- New: small portrait next to the lede; clicking it opens the big bio -->
    <img
      class="hero__portrait"
      src="assets/lonny.jpg"
      alt="Portrait of Lonny Grafman"
      loading="lazy"
      title="Open full bio"
    />
  </div>

  <div class="hero__ctas">
    <a href="#projects" class="btn btn--primary">See projects</a>
    <a class="btn btn--ghost" href="mailto:hello@example.com">Email me</a>
  </div>
</section>
  </header>

  <main class="wrap">
    <section id="projects" class="projects" aria-labelledby="proj">
      <h2 id="proj">Projects</h2>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div class="scroll-progress" aria-hidden="true"></div>
    </section>

    <section id="about" class="about" hidden>
      <button class="about__close" aria-label="Close about" title="Close">×</button>
      <img class="about__img" src="assets/lonny.jpg" alt="Photo of Lonny Grafman">
      <div class="about__text">
        <h2>About Lonny</h2>
        <p>I love working with awesome people to make great things happen.</p>
        <p>My international experience includes teaching at Universities in Mexico, Spain and Dominican Republic, and India, as well as founding a summer abroad, full immersion programs in resilient community technologies.</p>
        <p>As a teacher, I have a passion to foster creativity, deepen analytic abilities, increase competence, strengthen connections, and generally broaden knowledge in students primarily by working on real projects, with real clients, that ameliorate existing conditions by leveraging local knowledge, wealth and labor through transparency and stakeholder participation. Ultimately, I want the synthesis of the experience to engender a strong, and accurate, sense of competence and integrity in students, so that they can go on to accomplish their own goals.</p>
        <p>In my classroom, I try to foster a sense of openness through humor, fallibility, and modeling positive actions to critical feedback. Together, the students and I continue to improve the curriculum by collaboratively developing and evolving our course. As part of honoring the value that each of us bring, and celebrating that diverse teams are necessary to tackle the problems facing the world, we engage many styles that allow students of various needs, skills, and ways of being to thrive.</p>
        <p>I focus on building resilience in communities, organizations and individuals by leveraging our own resources to meet our own needs. I do this through education, design, facilitation, and implementation—with projects like Waterpod and Swale (a floating food barge in New York).</p>
        <p>I love getting to present on any and all of these things!</p>
        <p><strong>Projects:</strong> rainwater; greywater; earthen construction; participatory design; local entrepreneurship; manufacturing; appropriate technologies; renewable energy; off-grid systems; energy storage; solar electric micro-grids; solar hot water; social entrepreneurship; and many more.</p>
      </div>
    </section>

    <section id="contact" class="contact" aria-labelledby="ct">
      <h2 id="ct">Contact</h2>
      <p><a class="btn btn--primary" href="mailto:hello@example.com">Email me</a></p>
    </section>
  </main>

  <footer class="site-footer wrap">
    <p>© <span id="year"></span> Lonny Grafman · <a href="https://appropedia.org/" target="_blank" rel="noopener">Appropedia</a></p>
    <div class="social">
      <a href="https://instagram.com/" aria-label="Instagram">IG</a>
      <a href="https://www.linkedin.com/in/" aria-label="LinkedIn">LI</a>
      <a href="https://youtube.com/" aria-label="YouTube">YT</a>
    </div>
  </footer>

  <!-- Modal for project details -->
  <dialog id="modal" class="modal" aria-labelledby="mTitle">
    <div class="modal__dialog">
      <img id="mImg" class="modal__img" alt="">
      <div class="modal__body">
        <button id="mClose" class="about__close" aria-label="Close">×</button>
        <h3 id="mTitle" class="modal__title"></h3>
        <div id="mMeta" class="meta"></div>
        <p id="mReason" class="meta" style="margin-top:.25rem"></p>
        <div id="mDesc" style="margin-top:10px"></div>
        <div id="mImpacts" style="margin-top:10px"></div>
        <div id="mRoles" style="margin-top:10px"></div>
        <div id="mTags" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap"></div>
        <div id="mLinks" class="btnrow"></div>
      </div>
    </div>
  </dialog>

  <script>
    // ===== Basics & micro-interactions =====
    document.getElementById('year').textContent = new Date().getFullYear();

    const aboutPanel = document.querySelector('.about');

// Open About from nav link AND from the hero portrait
document.querySelectorAll('[data-open-about], .hero__portrait').forEach(el=>{
  el?.addEventListener('click', ()=> aboutPanel.hidden = false);
});

// Close button
document.querySelector('.about__close')?.addEventListener('click',()=> aboutPanel.hidden = true);

// Optional: click outside to close
aboutPanel?.addEventListener('click', (e) => {
  const within = e.target.closest('.about__text, .about__img, .about__close');
  if (!within) aboutPanel.hidden = true;
});

    // Scroll progress
    const progress = document.querySelector('.scroll-progress');
    const projects = document.getElementById('projects');
    function updateProgress(){
      const rect = projects.getBoundingClientRect();
      const total = rect.height - window.innerHeight;
      const seen = Math.min(Math.max(0, 0 - rect.top), total);
      const pct = total > 0 ? (seen/total)*100 : 0;
      progress.style.setProperty('--_pct', pct + '%');
    }
    updateProgress();
    addEventListener('scroll', updateProgress, {passive:true});
    addEventListener('resize', updateProgress);

    // Konami -> Punk mode (10s)
    (() => {
      const seq=[38,38,40,40,37,39,37,39,66,65]; let i=0;
      window.addEventListener('keydown', e=>{
        i=(e.keyCode===seq[i])?i+1:0;
        if(i===seq.length){ i=0; document.documentElement.classList.add('punk'); setTimeout(()=>document.documentElement.classList.remove('punk'),10000); }
      });
    })();

    // ===== Mobile long-press on portrait triggers punk mode =====
(function(){
  const portrait = document.querySelector('.hero__portrait');
  if(!portrait) return;

  let pressTimer;
  portrait.addEventListener('touchstart', () => {
    pressTimer = setTimeout(() => {
      document.documentElement.classList.add('punk');
      setTimeout(()=>document.documentElement.classList.remove('punk'), 10000); // auto reset
    }, 1200); // hold for 1.2s
  });
  portrait.addEventListener('touchend', () => clearTimeout(pressTimer));
  portrait.addEventListener('touchmove', () => clearTimeout(pressTimer));
})();

    // ===== CSV Loader =====
    const CSV_URL = new URLSearchParams(location.search).get('csv')
      || (window.PORTFOLIO_CONFIG && window.PORTFOLIO_CONFIG.CSV_URL)
      || "";

    async function fetchCSV(url){
      const res = await fetch(url, {mode:'cors'});
      if(!res.ok) throw new Error('CSV fetch failed: ' + res.status);
      return await res.text();
    }
    async function fetchCSVWithFallback(url){
      try { return await fetchCSV(url); }
      catch(e){
        const prox = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
        return await fetchCSV(prox);
      }
    }

    function parseCSV(text){
      const rows=[]; let row=[]; let cur=''; let inQ=false;
      for(let i=0;i<text.length;i++){
        const c=text[i]; const n=text[i+1];
        if(c==='"'){
          if(inQ && n === '"'){ cur+='"'; i++; }
          else { inQ = !inQ; }
        } else if(c===',' && !inQ){ row.push(cur); cur=''; }
        else if((c==='\n' || c==='\r') && !inQ){
          if(cur!=='' || row.length){ row.push(cur); rows.push(row); row=[]; cur=''; }
        } else { cur+=c; }
      }
      if(cur!=='' || row.length){ row.push(cur); rows.push(row); }
      return rows.filter(r=>r.length && r.some(x=>String(x).trim()!==''));
    }

    const HEADERS = {
      image:["image","Image","image_url","image url","img","thumbnail","thumb","Image (image file)","image (image file)"],
      title:["title","Title","overlay","overlay text","name"],
      reason:["reason","Reason","subtitle","subheading","The Reason"],
      description:["description","Description","desc"],
      impacts:["impacts","Impacts","impact"],
      dates:["dates","Dates","date","year"],
      roles:["roles","Roles","role"],
      links:["links","Links"],
      tags:["tags","Tags"],
      slug:["slug","Slug","id","ID"],
      published:["published","Published","publish","Publish"],
      order:["order_weight","order","Order","weight","Weight"]
    };
    function idxOf(headerRow, names){
      for(const n of names){
        const i = headerRow.findIndex(h => (h||'').trim().toLowerCase() === n.toLowerCase());
        if(i !== -1) return i;
      }
      return -1;
    }
    function truthy(v){
      if(v==null) return false;
      const s=String(v).trim().toLowerCase();
      return s==="true"||s==="1"||s==="yes"||s==="y"||s==="published";
    }
    function normalizeImage(url){
      if(!url) return '';
      url = url.trim();
      const m = url.match(/drive\.google\.com\/(?:file\/d\/|open\?id=)([\w-]+)/);
      if(m){ return `https://drive.google.com/uc?export=view&id=${m[1]}`; }
      if(url.includes('dropbox.com')){ return url.replace('www.dropbox.com','dl.dropboxusercontent.com').replace('?dl=0',''); }
      return url;
    }
    function parseLinks(s){
      if(!s) return [];
      return String(s).split(';').map(x=>x.trim()).filter(Boolean).map(x=>{
        if(x.includes('|')){ const [label,href]=x.split('|'); return {label:label.trim(), href:href.trim()}; }
        return {label:'Open', href:x};
      });
    }
    function parseTags(s){ if(!s) return []; return String(s).split(/[,;]/).map(t=>t.trim()).filter(Boolean); }

    // ===== Modal wiring =====
    const modal = document.getElementById('modal');
    const mImg = document.getElementById('mImg');
    const mTitle = document.getElementById('mTitle');
    const mMeta = document.getElementById('mMeta');
    const mReason = document.getElementById('mReason');
    const mDesc = document.getElementById('mDesc');
    const mImpacts = document.getElementById('mImpacts');
    const mRoles = document.getElementById('mRoles');
    const mTags = document.getElementById('mTags');
    const mLinks = document.getElementById('mLinks');
    document.getElementById('mClose').addEventListener('click', ()=> modal.close());
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.close(); });

    function safeHTML(s){ const div=document.createElement('div'); div.textContent=(s??''); return div.innerHTML; }
    function openModal(item){
      mImg.src = normalizeImage(item.image);
      mImg.alt = item.title || '';
      mTitle.textContent = item.title || '';
      mMeta.textContent = [item.dates].filter(Boolean).join(' · ');
      mReason.textContent = item.reason || '';
      mDesc.innerHTML = item.description ? safeHTML(item.description).replace(/\n/g,'<br>') : '';
      mImpacts.innerHTML = item.impacts ? `<strong>Impacts</strong><br>${safeHTML(item.impacts).replace(/\n/g,'<br>')}` : '';
      mRoles.innerHTML = item.roles ? `<strong>Roles</strong><br>${safeHTML(item.roles).replace(/\n/g,'<br>')}` : '';
      mTags.innerHTML = '';
      item.tags.forEach(t=>{ const span=document.createElement('span'); span.className='chip'; span.textContent=t; mTags.appendChild(span); });
      mLinks.innerHTML = '';
      item.links.forEach(l=>{ const a=document.createElement('a'); a.className='btn'; a.target='_blank'; a.rel='noopener'; a.href=l.href; a.textContent=l.label || 'Open'; mLinks.appendChild(a); });
      modal.showModal();
    }

    // ===== Build grid from CSV =====
    function toItem(row, headerRow){
      function pick(key){ const i = idxOf(headerRow, HEADERS[key]); return i>-1 ? row[i] : ''; }
      return {
        image: pick('image'),
        title: pick('title'),
        reason: pick('reason'),
        description: pick('description'),
        impacts: pick('impacts'),
        dates: pick('dates'),
        roles: pick('roles'),
        links: parseLinks(pick('links')),
        tags: parseTags(pick('tags')),
        slug: pick('slug'),
        published: truthy(pick('published')),
        order: Number(pick('order')) || 999999
      };
    }

    function buildCard(item){
      const el = document.createElement('article'); el.className='card';
      const img = document.createElement('img'); img.loading='lazy'; img.alt = item.title || 'Project image'; img.src = normalizeImage(item.image) || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="450"><rect width="100%" height="100%" fill="%23141515"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23a0a0a0" font-family="IBM Plex Mono" font-size="16">Image unavailable</text></svg>';
      const overlay = document.createElement('div'); overlay.className='card__overlay'; overlay.textContent = item.title || '(Untitled)';
      el.append(img, overlay);
      el.addEventListener('click', ()=> openModal(item));
      return el;
    }

    async function init(){
      try{
        if(!CSV_URL){ throw new Error('No CSV URL provided. Add window.PORTFOLIO_CONFIG.CSV_URL or use ?csv='); }
        const text = await fetchCSVWithFallback(CSV_URL);
        const rows = parseCSV(text);
        if(!rows.length){ throw new Error('Empty CSV'); }
        const header = rows[0];
        const items = rows.slice(1).map(r=>toItem(r, header))
          .filter(it => it.title && it.published)
          .sort((a,b)=> a.order - b.order || String(a.title).localeCompare(String(b.title)));

        const grid = document.getElementById('grid'); grid.innerHTML = '';
        if(!items.length){
          grid.innerHTML = '<p style="color:var(--muted)">No published projects in the sheet yet.</p>';
          return;
        }
        items.forEach(it => grid.appendChild(buildCard(it)));
        updateProgress();

        // Deep-link support ?project=slug or #slug
        const target = new URLSearchParams(location.search).get('project') || location.hash.replace('#','');
        if(target){
          const hit = items.find(i => (i.slug||'').toLowerCase() === target.toLowerCase());
          if(hit) openModal(hit);
        }
      }catch(err){
        console.error(err);
        const grid = document.getElementById('grid');
        grid.innerHTML = '<p style="color:#ff7b72">Could not load projects. Open the console for details.</p>';
      }
    }

    init();
  </script>
</body>
</html>
